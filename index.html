<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mail Sender</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 10px; 
    background: #f4f6f9;
  }
  h2 {
    text-align: center;
    margin-bottom: 10px;
    color: #333;
  }
  form {
    background-image: linear-gradient(to right,#ff4d00,#7d20cb);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    max-width: 500px;
    margin: auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 20px;
  }
  label {
    font-weight: bold;
    display: block;
    margin-bottom: 3px;
    color: #faf7f7;
  }
  input, select, button {
    padding: 5px;
    width: 100%;
    border: 3px solid #ccc;
    border-radius: 10px;
    font-size: 12px;
  }
  input:focus, select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0,123,255,0.4);
  }
  .hidden { display: none !important; }
  #accountDetails {
    grid-column: span 2;
    background-image: linear-gradient(to right,#ff4d00,#7d20cb);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    max-width: 500px;
    margin: auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 20px;
    padding: 15px;
    border-radius: 8px;
    border: 2px solid #ddd;
  }
  #accountDetails.visible {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 20px;
  }
  #accountDetails h3 { 
    margin: 0 0 0.5px 0; 
    grid-column: span 2; 
    color: #000000; 
  }
  .error { color: red; grid-column: span 2; }
  button {
    background: #007bff;
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
    grid-column: span 2;
    transition: 0.3s;
  }
  button:hover { background: #0056b3; }
</style>
</head>
<body>

<h2>Branch Mail Sender</h2>
<form id="mailForm">
  <div>
    <label for="mailType">Mail Type*</label>
    <select id="mailType" required>
      <option value="">Select Mail Type</option>
      <option value="Packet Hold From The Auction">Packet Hold From The Auction</option>
      <option value="Packet Availability Confirmation">Packet Availability Confirmation</option>
      <option value="Customer Query For Auction Surplus">Customer Query For Auction Surplus</option>
      <option value="Customer Query for Auction Details">Customer Query for Auction Details</option>
      <option value="Handover the DD To The Customer">Handover the DD To The Customer</option>
      <option value="Transfer of Surplus Amount To Customer">Transfer of Surplus Amount To Customer</option>
    </select>
  </div>

  <div>
    <label for="glId">GL ID*</label>
    <input type="text" id="glId" pattern="\d+" required placeholder="Enter GL ID (numbers only)">
  </div>

  <div>
    <label for="customerName">Customer Name*</label>
    <input type="text" id="customerName" pattern="[A-Za-z\s]+" required placeholder="Enter Customer Name">
  </div>

  <div>
    <label for="customerNumber">Customer Number*</label>
    <input type="text" id="customerNumber" pattern="\d+" required placeholder="Enter Customer Number">
  </div>

  <div>
    <label for="branchNameInput">Branch Name*</label>
    <input list="branchList" id="branchNameInput" required placeholder="Select or type branch">
    <datalist id="branchList">
      <option value="Test">
      <option value="Fed - Pune /Phursungi">
    </datalist>
  </div>

  <div>
    <label for="mappedEmail">Mapped Email*</label>
    <input type="email" id="mappedEmail" readonly required placeholder="Mapped Email">
  </div>

  <div>
    <label for="regards">Regards*</label>
    <select id="regards" required>
      <option value="">Select</option>
      <option value="Test">Test</option>
      <option value="Karthik">Karthik</option>
      <option value="Yatish">Yatish</option>
      <option value="Arif">Arif</option>
      <option value="Manasa">Manasa</option>
      <option value="Vijay">Vijay</option>
      <option value="Margaret">Margaret</option>
      <option value="Rajendra">Rajendra</option>
      <option value="Prashanth">Prashanth</option>
      <option value="Vidyadhar">Vidyadhar</option>
      <option value="Fouziya">Fouziya</option>
      <option value="Krishnaveni">Krishnaveni</option>
      <option value="Azmath">Azmath</option>
      <option value="Nageena">Nageena</option>
      <option value="Sana">Sana</option>
      <option value="Asha">Asha</option>
      <option value="Eram">Eram</option>
    </select>
  </div>

  <div id="passwordContainer">
    <label for="password">Password*</label>
    <input type="password" id="password" required placeholder="Enter Password">
  </div>

  <div id="approvalEmailContainer" class="hidden">
    <label for="approvalEmail">Approval Email*</label>
    <select id="approvalEmail">
      <option value="">Select Approval Email</option>
      <option value="arif.pasha@rupeek.com">arif.pasha@rupeek.com</option>
      <option value="yatish.r@rupeek.com">yatish.r@rupeek.com</option>
      <option value="m.manasa@rupeek.com">m.manasa@rupeek.com</option>
      <option value="vijay.r01@rupeek.com">vijay.r01@rupeek.com</option>
    </select>
  </div>

  <div id="accountDetails" class="hidden">
    <label for="bankAccount">Bank A/C Number*</label>
    <input type="text" id="bankAccount">

    <label for="bankName">Bank Name*</label>
    <input type="text" id="bankName">

    <label for="ifsc">IFSC Code*</label>
    <input type="text" id="ifsc">

    <label for="passbook">Passbook / Cheque Leaf*</label>
    <input type="file" id="passbook">

    <label for="aadhar">Aadhar Card (optional)</label>
    <input type="file" id="aadhar">

    <label for="pan">Pan Card (optional)</label>
    <input type="file" id="pan">
  </div>

  <div class="error" id="errorMsg"></div>
  <button type="submit" id="sendMailBtn">Send Mail</button>
</form>

<script>
const branchEmails = {"Test":"vidyadhar.patil@rupeek.com","Fed - Pune / Pimple Saudagar":"pnei@federalbank.co.in"};

const regardsPasswords = {"Test":"August@2025","Karthik":"A7d9X","Yatish":"m3Pq2","Arif":"Z5yL0","Manasa":"t9Bv4","Rajendra":"R2hK8","Prashanth":"c7Nw1","Vijay":"F6gQ3","Margaret":"M6TQ3","Vidyadhar":"3834" };

const passwordNames = ["Vijay","Manasa","Yatish","Arif","Karthik","Rajendra","Prashanth","Vidyadhar"];
const approvalNames = ["Fouziya","Krishnaveni","Margaret","Azmath","Nageena","Sana","Asha","Eram"];

const mailType = document.getElementById('mailType');
const branchNameInput = document.getElementById('branchNameInput');
const mappedEmail = document.getElementById('mappedEmail');
const regards = document.getElementById('regards');
const password = document.getElementById('password');
const passwordContainer = document.getElementById('passwordContainer');
const approvalEmailContainer = document.getElementById('approvalEmailContainer');
const approvalEmail = document.getElementById('approvalEmail');
const accountDetails = document.getElementById('accountDetails');
const customerNameInput = document.getElementById('customerName');
const form = document.getElementById('mailForm');
const errorMsg = document.getElementById('errorMsg');
const sendBtn = document.getElementById('sendMailBtn');

regards.addEventListener('change', ()=>{
    if(passwordNames.includes(regards.value)){
        passwordContainer.classList.remove('hidden');
        approvalEmailContainer.classList.add('hidden');
        approvalEmail.value = '';
    } else if(approvalNames.includes(regards.value)){
        passwordContainer.classList.add('hidden');
        password.value = '';
        approvalEmailContainer.classList.remove('hidden');
    } else {
        passwordContainer.classList.remove('hidden');
        approvalEmailContainer.classList.add('hidden');
    }
});

mailType.addEventListener('change', () => {
  accountDetails.classList.toggle('hidden', mailType.value !== "Transfer of Surplus Amount To Customer");
});

branchNameInput.addEventListener('input', () => {
  mappedEmail.value = branchEmails[branchNameInput.value] || '';
});

customerNameInput.addEventListener('input', () => {
  let words = customerNameInput.value.split(' ');
  words = words.map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase());
  customerNameInput.value = words.join(' ');
});

function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function getEmailContent(data){
  let subject='', body=`Dear Branch Staff,<br><br>`;
  switch(data.mailType){
    case "Packet Hold From The Auction":
      subject=`Hold The Packet From The Auction ${data.glId}-${data.customerName}`;
      body+=`Kindly hold the packet from the auction, as the customer is willing to do the payment<br><br>`;
      break;
    case "Packet Availability Confirmation":
      subject=`Packet Availability Confirmation ${data.glId}-${data.customerName}`;
      body+=`Kindly confirm the packet availability status for below mentioned customer, and the customer is willing to do the payment<br><br>`;
      break;
    case "Customer Query for Auction Details":
      subject=`Customer Query for Auction Details ${data.glId}-${data.customerName}`;
      body+=`Customer has reached out to us requesting the gold auction details. You are requested to kindly furnish the auction details for the information of customer <br>Please find the customer details below.<br><br>`;
      break;
    case "Customer Query For Auction Surplus":
      subject=`Customer Query For Auction Surplus ${data.glId}-${data.customerName}`;
      body+=`Customer ${data.customerName} has requested details of the auction surplus (if any). You are kindly requested to furnish the surplus details for the customerâ€™s information.<br>Please find the customer details below.<br><br>`;
      break;
    case "Transfer of Surplus Amount To Customer":
      subject=`Transfer of Surplus Amount To Customer ${data.glId}-${data.customerName}`;
      body+=`Customer has reached out to us requesting the transfer of the surplus amount. You are requested to confirm the same at the earliest.<br>Please find the customer details below.<br><br>`;
      break;
    case "Handover the DD To The Customer":
      subject=`Handover the DD To The Customer ${data.glId}-${data.customerName}`;
      body+=` Customer has reached out to us requesting for the available DD, Kindly Handover to the customer. <br>Details are provided below.<br><br>`;
      break;
  }

  body += `
<table style="width:100%; max-width:600px; border-collapse:collapse; font-family:Arial, sans-serif; font-size:14px; color:#333;">
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd; width:35%;">GL ID</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.glId}</td>
  </tr>
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd;">Customer Name</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.customerName}</td>
  </tr>
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd;">Customer Number</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.customerNumber}</td>
  </tr>
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd;">Branch Name</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.branchName}</td>
  </tr>
</table>
`;

  if(data.mailType==="Transfer of Surplus Amount To Customer"){
    body += `
<br>
<b style="font-family:Arial, sans-serif; font-size:15px; color:#222;">Bank Details:</b><br><br>
<table style="width:100%; max-width:600px; border-collapse:collapse; font-family:Arial, sans-serif; font-size:14px; color:#333;">
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd; width:35%;">Bank A/C Number</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.bankAccount}</td>
  </tr>
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd;">Bank Name</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.bankName}</td>
  </tr>
  <tr>
    <td style="background:#f4f6f9; font-weight:bold; padding:8px; border:1px solid #ddd;">IFSC Code</td>
    <td style="padding:8px; border:1px solid #ddd;">${data.ifsc}</td>
  </tr>
</table>
<br>
<i style="font-family:Arial, sans-serif; font-size:13px; color:#555;">Supporting documents attached.</i><br>
`;
  }

  body+=`<br><br>Regards,<br>${data.regards}`;
  return {subject, body};
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  errorMsg.textContent='';

  // Password validation if required
  if(passwordContainer.classList.contains('hidden')===false && passwordNames.includes(regards.value)){
    if(password.value!==regardsPasswords[regards.value]){
      errorMsg.textContent="Incorrect password for selected Regards";
      return;
    }
  }

  if(!accountDetails.classList.contains('hidden')){
    const requiredFields=['bankAccount','bankName','ifsc','passbook'];

    for(const id of requiredFields){
      if(id === "passbook"){
        if(!document.getElementById(id).files.length){
          errorMsg.textContent="All account details are mandatory";
          return;
        }
      } else {
        if(!document.getElementById(id).value){
          errorMsg.textContent="All account details are mandatory";
          return;
        }
      }
    }
  }

  if(approvalEmailContainer.classList.contains('hidden')===false && !approvalEmail.value){
    errorMsg.textContent="Please select Approval Email";
    return;
  }

  sendBtn.disabled=true; sendBtn.textContent="Sending...";

  try{
    const data={
      mailType: mailType.value,
      glId: document.getElementById('glId').value,
      customerName: customerNameInput.value,
      customerNumber: document.getElementById('customerNumber').value,
      branchName: branchNameInput.value,
      mappedEmail: mappedEmail.value,
      regards: regards.value,
      password: password.value,
      approvalEmail: approvalEmail.value
    };

    if(!accountDetails.classList.contains('hidden')){
      data.bankAccount=document.getElementById('bankAccount').value;
      data.bankName=document.getElementById('bankName').value;
      data.ifsc=document.getElementById('ifsc').value;

      const passbookFile=document.getElementById('passbook').files[0];
      if(passbookFile){
        data.passbook=await fileToBase64(passbookFile);
        data.passbookType=passbookFile.type;
      }

      const aadharFile=document.getElementById('aadhar').files[0];
      if(aadharFile){
        data.aadhar=await fileToBase64(aadharFile);
        data.aadharType=aadharFile.type;
      }

      const panFile=document.getElementById('pan').files[0];
      if(panFile){
        data.pan=await fileToBase64(panFile);
        data.panType=panFile.type;
      }
    }

    const emailContent=getEmailContent(data);
    data.subject=emailContent.subject;
    data.body=emailContent.body;

    const response=await fetch("https://script.google.com/macros/s/AKfycby32T1MDQKpp_ZM5begUtKESTGKGNsCI4Iaw33n49D64h_pDIe9WlZlP1nl8tq6PEuD/exec", {
      method:"POST",
      body:JSON.stringify(data)
    });
    const result=await response.json();
    if(result.status==="success"){
      alert("Mail sent successfully!");
      form.reset(); mappedEmail.value=''; accountDetails.classList.add('hidden'); 
      passwordContainer.classList.remove('hidden'); approvalEmailContainer.classList.add('hidden');
    }else errorMsg.textContent=result.message;

  }catch(err){errorMsg.textContent=err.message;}

  sendBtn.disabled=false; sendBtn.textContent="Send Mail";
});
</script>
</body>
</html>
